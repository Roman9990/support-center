<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Центр Управления</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:sans-serif;background:#111;color:#eee;overflow-x:hidden}
    body::before{content:'';position:fixed;inset:0;background:linear-gradient(-45deg,#ff004f,#590fb7,#00e5ff,#ffea00);background-size:400% 400%;animation:bgAnim 20s ease infinite;z-index:-1}
    @keyframes bgAnim{0%{background-position:0 50%}50%{background-position:100% 50%}100%{background-position:0 50%}}
    .container{max-width:800px;margin:40px auto;padding:20px;text-align:center}
    h1{font-size:2.5rem;margin-bottom:10px;animation:fadeIn 1s}
    @keyframes fadeIn{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}
    .tabs{display:flex;justify-content:center;gap:20px;margin:20px}
    .tab{padding:8px 16px;cursor:pointer;border-radius:8px;transition:background .3s}
    .tab.active{background:rgba(255,255,255,0.2)}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;opacity:0;animation:fadeIn 1s .5s forwards}
    .card{background:rgba(255,255,255,0.1);border-radius:12px;padding:20px;cursor:pointer;transition:transform .3s}
    .card:hover{transform:scale(1.05)}
    .tag{font-weight:700;margin-bottom:8px}
    .status{display:flex;align-items:center;justify-content:center;gap:8px;margin-bottom:8px}
    .dot{width:10px;height:10px;border-radius:50%;animation:pulse 2s infinite}
    @keyframes pulse{0%,100%{transform:scale(1)}50%{transform:scale(1.4)}}
    .online .dot{background:#4caf50}
    .offline .dot{background:#f44336;animation:none}
    .role{opacity:.8;font-size:.9rem;text-transform:uppercase}
    .unavail{margin-top:30px;opacity:0;animation:fadeIn 1s .7s forwards}
    .unavail ul{list-style:none;display:flex;flex-wrap:wrap;gap:10px;justify-content:center}
    .unavail li{background:rgba(255,255,255,0.1);padding:6px 12px;border-radius:8px}
  </style>
</head>
<body>
  <div class="container">
    <h1>Центр Управления</h1>
    <div class="tabs">
      <div id="tab-available" class="tab active">Доступные</div>
      <div id="tab-unavailable" class="tab">Недоступные</div>
    </div>
    <div id="available" class="grid"></div>
    <div id="unavailable" class="unavail" style="display:none">
      <h2>Временно недоступны</h2>
      <ul id="unlist"></ul>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded',()=>{
      if(window.Telegram?.WebApp) Telegram.WebApp.ready();
      document.getElementById('tab-available').onclick=()=>showTab('available');
      document.getElementById('tab-unavailable').onclick=()=>showTab('unavailable');
      load();
    });
    function showTab(id){
      document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
      document.getElementById('tab-'+id).classList.add('active');
      document.getElementById('available').style.display= id==='available'?'grid':'none';
      document.getElementById('unavailable').style.display= id==='unavailable'?'block':'none';
    }
    function load(){
      const p=new URLSearchParams(location.search).get('data');
      if(!p){render([]);return;}
      let admins; try{admins=JSON.parse(atob(p)).admins||[]}catch{admins=[]}
      const avail=admins.filter(a=>a.status==='online');
      const un=admins.filter(a=>a.status!=='online');
      render(avail); renderUn(un);
    }
    function render(av){
      const c=document.getElementById('available'); c.innerHTML='';
      if(!av.length){c.innerHTML='<p>Нет онлайн админов</p>';return}
      av.forEach(a=>{
        const d=document.createElement('div');d.className='card '+a.status;
        d.innerHTML=`<div class="tag">#${a.tag}</div>
                     <div class="status ${a.status}"><span class="dot"></span>${a.status==='online'?'В сети':'Не в сети'}</div>
                     <div class="role">${translate(a.role)}</div>`;
        d.onclick=()=>{
          const sel={action:'select_admin',admin_id:a.id,admin_tag:a.tag};
          Telegram.WebApp.sendData(JSON.stringify(sel));
        };
        c.appendChild(d);
      });
    }
    function renderUn(un){
      const ul=document.getElementById('unlist'); ul.innerHTML='';
      if(!un.length){ul.innerHTML='<li>Пусто</li>'}
      un.forEach(a=>{
        const li=document.createElement('li');li.textContent='#'+a.tag;ul.appendChild(li);
      });
    }
    function translate(r){
      return{'owner':'Владелец','admin':'Администратор','moderator':'Модератор','support':'Поддержка'}[r]||r;
    }
  </script>
</body>
</html>
